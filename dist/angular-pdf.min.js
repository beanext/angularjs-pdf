/*! Angular-PDF Version: 1.2.4 | Released under an MIT license */
!function(){"use strict";angular.module("pdf",[]).directive("ngPdf",["$window",function($window){var renderTask=null,pdfLoaderTask=null,backingScale=function(canvas){var ctx=canvas.getContext("2d"),dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;return dpr/bsr},setCanvasDimensions=function(canvas,w,h){var ratio=backingScale(canvas);return canvas.width=Math.floor(w*ratio),canvas.height=Math.floor(h*ratio),canvas.style.width=Math.floor(w)+"px",canvas.style.height=Math.floor(h)+"px",canvas.getContext("2d").setTransform(ratio,0,0,ratio,0,0),canvas};return{restrict:"E",templateUrl:function(element,attr){return attr.templateUrl?attr.templateUrl:"partials/viewer.html"},link:function(scope,element,attrs){function clearCanvas(){ctx&&ctx.clearRect(0,0,canvas.width,canvas.height)}function renderPDF(){clearCanvas(),url&&url.length&&(pdfLoaderTask=PDFJS.getDocument({url:url,withCredentials:creds},null,null,scope.onProgress),pdfLoaderTask.then(function(_pdfDoc){"function"==typeof scope.onLoad&&scope.onLoad(),pdfDoc=_pdfDoc,scope.renderPage(scope.pageToDisplay),scope.$apply(function(){scope.pageCount=_pdfDoc.numPages})},function(error){error&&"function"==typeof scope.onError&&scope.onError(error)}))}var scale,url=scope.pdfUrl,pdfDoc=null,pageNum=attrs.page?attrs.page:1;"fill"!==attrs.scale&&(scale=attrs.scale>0?attrs.scale:1);var canvas;canvas=attrs?document.getElementById(attrs.canvasid):document.getElementById("pdf-canvas");var canvasContainer=angular.element(canvas).parent(),creds=attrs.usecredentials,ctx=canvas.getContext("2d"),windowEl=angular.element($window);windowEl.on("scroll",function(){scope.$apply(function(){scope.scroll=windowEl[0].scrollY})}),PDFJS.disableWorker=!0,scope.pageNum=pageNum;var isFullScreen=function(){return document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen||!1},getFullScreenSupportName=function(){var doc=document.documentElement;return"webkitRequestFullScreen"in doc?"webkitfullscreenchange":"mozRequestFullScreen"in doc&&document.mozFullScreenEnabled?"mozfullscreenchange":"requestFullscreen"in doc?"fullscreenchange":!1},isFullScreenSupport=function(){var doc=document.documentElement;return"requestFullscreen"in doc||"webkitRequestFullScreen"in doc||"mozRequestFullScreen"in doc&&document.mozFullScreenEnabled||!1};isFullScreenSupport()&&document.addEventListener(getFullScreenSupportName(),function(evt){isFullScreen()||canvasContainer.css({"text-align":"center",position:"relative",width:"100%",height:scope.originBox.height+"px",margin:"",top:"",left:""}),scale=void 0,scope.changePage()},!1),scope.mouseScrollReset=function(){scope.mouseScrollTimeStamp=0,scope.mouseScrollDelta=0};var getWindowHeight=function(){var windowHeight=0;return windowHeight="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight};scope.mouseScrollReset();var handleMouseWheel=function(evt){if(isFullScreen()&&canvas){var MOUSE_WHEEL_DELTA_FACTOR=40,ticks="DOMMouseScroll"===evt.type?-evt.detail:evt.wheelDelta/MOUSE_WHEEL_DELTA_FACTOR,delta=ticks*MOUSE_WHEEL_DELTA_FACTOR,MOUSE_SCROLL_COOLDOWN_TIME=50,PAGE_SWITCH_THRESHOLD=120,PageSwitchDirection={UP:-1,DOWN:1},currentTime=(new Date).getTime(),storedTime=scope.mouseScrollTimeStamp;if(currentTime>storedTime&&MOUSE_SCROLL_COOLDOWN_TIME>currentTime-storedTime)return;if((scope.mouseScrollDelta>0&&0>delta||scope.mouseScrollDelta<0&&delta>0)&&scope.mouseScrollReset(),scope.mouseScrollDelta+=delta,Math.abs(scope.mouseScrollDelta)>=PAGE_SWITCH_THRESHOLD){var pageSwitchDirection=scope.mouseScrollDelta>0?PageSwitchDirection.UP:PageSwitchDirection.DOWN;if(pageSwitchDirection===PageSwitchDirection.DOWN&&canvasContainer[0].scrollTop+getWindowHeight()==canvasContainer[0].scrollHeight||pageSwitchDirection===PageSwitchDirection.UP&&0==canvasContainer[0].scrollTop){var page=scope.pageToDisplay;if(scope.mouseScrollReset(),1===page&&pageSwitchDirection===PageSwitchDirection.UP||page===scope.pageCount&&pageSwitchDirection===PageSwitchDirection.DOWN)return;scope.pageToDisplay=parseInt(scope.pageToDisplay)+pageSwitchDirection,scope.pageNum=scope.pageToDisplay,scope.mouseScrollTimeStamp=currentTime,scope.$apply()}}}};window.addEventListener("DOMMouseScroll",handleMouseWheel),window.addEventListener("mousewheel",handleMouseWheel),window.addEventListener("mousedown",function(evt){if(isFullScreen()&&canvas&&0===evt.button){var isInternalLink=evt.target.href&&evt.target.classList.contains("internalLink");isInternalLink||(evt.preventDefault(),scope.pageToDisplay=parseInt(scope.pageToDisplay)+(evt.shiftKey?-1:1),scope.pageNum=scope.pageToDisplay,scope.$apply())}}),scope.fullScreen=function(){if(isFullScreenSupport())if(isFullScreen())exitFullscreen();else{var resequestFullScreen=canvasContainer[0].requestFullScreen||canvasContainer[0].webkitRequestFullScreen||canvasContainer[0].mozRequestFullScreen;resequestFullScreen&&(canvasContainer.css({position:"fixed",top:"0",left:"0",margin:"0px 10%",width:"80%",height:"100%"}),resequestFullScreen.call(canvasContainer[0]))}else console.error("your browser is not support fullscreen api")},scope.renderPage=function(num){renderTask&&renderTask._internalRenderTask.cancel(),pdfDoc.getPage(num).then(function(page){var viewport,pageWidthScale,pageHeightScale,renderContext;"page-fit"!==attrs.scale||scale?"fill"!==attrs.scale||scale?"rotate"!==attrs.scale||scale?viewport=page.getViewport(scale):(viewport=page.getViewport(1),pageWidthScale=canvasContainer[0].clientHeight/viewport.width,pageHeightScale=canvasContainer[0].clientWidth/viewport.height,scale=isFullScreen()?Math.max(pageWidthScale,pageHeightScale):Math.min(pageWidthScale,pageHeightScale),viewport=page.getViewport(scale)):(viewport=page.getViewport(1),pageWidthScale=canvasContainer[0].clientWidth/viewport.width,pageHeightScale=canvasContainer[0].clientHeight/viewport.height,scale=Math.max(pageWidthScale,pageHeightScale),viewport=page.getViewport(scale)):(viewport=page.getViewport(1),pageWidthScale=element[0].clientWidth/viewport.width,pageHeightScale=element[0].clientHeight/viewport.height,scale=Math.min(pageWidthScale,pageHeightScale)),setCanvasDimensions(canvas,viewport.width,viewport.height),renderContext={canvasContext:ctx,viewport:viewport},renderTask=page.render(renderContext),renderTask.promise.then(function(){"function"==typeof scope.onPageRender&&scope.onPageRender()})["catch"](function(reason){console.log(reason)})})},scope.onPageRender=function(){scope.originBox||(scope.originBox={width:canvasContainer[0].clientWidth,height:canvasContainer[0].clientHeight})},scope.goPrevious=function(){scope.pageToDisplay<=1||(scope.pageToDisplay=parseInt(scope.pageToDisplay)-1,scope.pageNum=scope.pageToDisplay)},scope.goNext=function(){scope.pageToDisplay>=pdfDoc.numPages||(scope.pageToDisplay=parseInt(scope.pageToDisplay)+1,scope.pageNum=scope.pageToDisplay)},scope.zoomIn=function(){return scale=parseFloat(scale)+.2,scope.renderPage(scope.pageToDisplay),scale},scope.zoomOut=function(){return scale=parseFloat(scale)-.2,scope.renderPage(scope.pageToDisplay),scale},scope.changePage=function(){scope.renderPage(scope.pageToDisplay)},scope.rotateLT=function(){"rotate0"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate270"),attrs.scale="rotate"):"rotate90"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate0"),attrs.scale="fill"):"rotate180"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate90"),attrs.scale="rotate"):(canvas.setAttribute("class","rotate180"),attrs.scale="fill"),scale=void 0,scope.changePage()},scope.rotateRT=function(){"rotate0"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate90"),attrs.scale="rotate"):"rotate90"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate180"),attrs.scale="fill"):"rotate180"===canvas.getAttribute("class")?(canvas.setAttribute("class","rotate270"),attrs.scale="rotate"):(canvas.setAttribute("class","rotate0"),attrs.scale="fill"),scale=void 0,scope.renderPage(scope.pageToDisplay)},scope.$watch("pageNum",function(newVal){scope.pageToDisplay=parseInt(newVal),null!==pdfDoc&&scope.renderPage(scope.pageToDisplay)}),scope.$watch("pdfUrl",function(newVal){""!==newVal&&(angular.debug&&console.log("pdfUrl value change detected: ",scope.pdfUrl),url=newVal,scope.pageToDisplay=1,pdfLoaderTask?pdfLoaderTask.destroy().then(function(){renderPDF()}):renderPDF())})}}}])}();